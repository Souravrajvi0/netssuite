====================================================================
AGTAX AI KNOWLEDGE BASE ASSISTANT
COMPLETE DEPLOYMENT GUIDE
====================================================================

This guide covers deploying the AI-powered knowledge base assistant
to multiple NetSuite client accounts.

====================================================================
PART 1: UNDERSTANDING THE SYSTEM
====================================================================

ARCHITECTURE:
-------------
1. Knowledge Base Articles (25 text files)
   - Stored in File Cabinet
   - Plain text with placeholders for dynamic URLs
   - Single set works for ALL clients

2. Articles Index (JSON file)
   - Contains metadata for all articles
   - Includes Internal IDs for File Cabinet references
   - Generated once, uploaded to File Cabinet

3. Suitelet (JavaScript file)
   - Main application logic
   - LLM-powered search and ranking
   - Dynamic URL generation
   - Single codebase for all clients

4. Client Script (JavaScript file)
   - Floating button on NetSuite pages
   - Opens chatbot interface
   - Same for all clients

5. User Event Script (JavaScript file)
   - Injects client script on page load
   - Same for all clients

KEY FEATURES:
-------------
âœ“ LLM-powered article search and ranking
âœ“ Multi-client URL generation (no hardcoding!)
âœ“ TDS & AG Tax module integration
âœ“ Token-efficient architecture (~2,500 tokens/query)
âœ“ Production-ready error handling
âœ“ Caching for performance
âœ“ Professional UI

====================================================================
PART 2: FIRST-TIME SETUP (DEVELOPMENT ACCOUNT)
====================================================================

STEP 1: PREPARE ARTICLE FILES
------------------------------
Time: 2-3 hours

1. Update all 25 article files with placeholders:

   BEFORE:
   "Navigate to the TDS Master creation page and fill in the form."

   AFTER:
   "Click [CREATE:TDS_MASTER] to open the creation form."

2. Common placeholders to use:
   - [CREATE:RESOURCE] - Create new record button
   - [LIST:RESOURCE] - View all records link
   - [EDIT:RESOURCE:ID] - Edit specific record
   - [NAV:RESOURCE] - Navigate to page

3. Available resources (see URL_MAPPINGS in Suitelet):
   - TDS_MASTER
   - TDS_SECTIONS
   - TDS_PAYMENT
   - TDS_CHALLAN
   - AGTAX_MATRIX
   - AGTAX_CONFIGURATION
   - TAX_CODES
   - CUSTOMERS
   - VENDORS
   - INVOICES
   - VENDOR_BILLS
   - PAYMENT_TRANSACTIONS
   - JOURNAL_ENTRIES
   - REPORTS_TDS
   - REPORTS_AGTAX

4. Use the sample file as reference:
   05_tds_master_SAMPLE_WITH_PLACEHOLDERS.txt

STEP 2: UPLOAD ARTICLES TO FILE CABINET
----------------------------------------
Time: 30 minutes

1. Log into NetSuite (Development account)

2. Navigate to: Documents > Files > File Cabinet

3. Create folder structure:
   /SuiteScripts/
   â””â”€â”€ Knowledge Base/
       â”œâ”€â”€ articles/
       â””â”€â”€ config/

4. Upload all 25 article .txt files to:
   /SuiteScripts/Knowledge Base/articles/

5. IMPORTANT: Note the Internal ID of each file
   - Click on uploaded file
   - Look at URL: ...file.nl?id=XXXX
   - XXXX is the Internal ID
   - You need these for the index!

STEP 3: CREATE ARTICLES INDEX
------------------------------
Time: 30 minutes

1. Open: articles_index.json

2. Update each article's file_id with Internal IDs from Step 2:

   {
     "articles": [
       {
         "id": 1,
         "title": "TDS Overview and Setup Guide",
         "file_id": "3150",  // <-- UPDATE THIS with your Internal ID
         "summary": "...",
         "keywords": [...]
       },
       // ... repeat for all 25 articles
     ]
   }

3. Save the updated JSON file

4. Upload to File Cabinet:
   - Location: /SuiteScripts/Knowledge Base/config/
   - File: articles_index.json
   - Note its Internal ID (you'll need this next!)

STEP 4: CONFIGURE SUITELET
---------------------------
Time: 15 minutes

1. Open: netsuite_assistant_COMPLETE_FINAL.js

2. Update Line 21 (Index File ID):

   BEFORE:
   INDEX_FILE_ID: '3164', // CHANGE: Your articles_index.json Internal ID

   AFTER:
   INDEX_FILE_ID: '3456', // <-- Your actual Internal ID from Step 3

3. Update Lines 30-120 (URL Mappings) with YOUR custom record types:

   Find custom record type IDs:
   a. Go to: Customization > Lists, Records, & Fields > Record Types
   b. Click on "AG Tax TDS Master" (or your custom record)
   c. Look at URL: ...custrecordentrylist.nl?rectype=XXXX
   d. XXXX is your rectype ID

   Update URLs:

   TDS_MASTER: {
       recordType: 'customrecord_agtax_tdsmaster',
       createUrl: '/app/common/custom/custrecordentry.nl?rectype=1042', // <-- Change 1042
       listUrl: '/app/common/custom/custrecordentrylist.nl?rectype=1042', // <-- Change 1042
       label: 'TDS Master'
   },

   Repeat for:
   - TDS_SECTIONS (rectype)
   - TDS_PAYMENT (rectype)
   - TDS_CHALLAN (rectype)
   - AGTAX_MATRIX (rectype)
   - AGTAX_CONFIGURATION (rectype)

4. Standard NetSuite records (CUSTOMERS, VENDORS, INVOICES, etc.) work automatically!

5. Save the file

STEP 5: UPLOAD SUITELET TO NETSUITE
------------------------------------
Time: 15 minutes

1. Navigate to: Documents > Files > File Cabinet

2. Upload to: /SuiteScripts/
   - File: netsuite_assistant_COMPLETE_FINAL.js
   - Note the Internal ID

3. Create Suitelet record:
   a. Go to: Customization > Scripting > Scripts > New
   b. Upload script file (or select from File Cabinet)
   c. Click Create Script Record

   d. Fill in details:
      - Name: AGTAX Knowledge Assistant
      - ID: _agtax_assistant_sl
      - Function: onRequest

   e. Save

4. Create Deployment:
   a. Click "Deploy Script"

   b. Fill in:
      - Title: AGTAX Assistant Production
      - ID: _agtax_assistant_sl
      - Status: Testing (initially)
      - Log Level: Debug (initially)
      - Audience: All Roles

   c. Save

5. Get Suitelet URL:
   - Copy the External URL from deployment
   - Format: https://ACCOUNTID.app.netsuite.com/app/site/hosting/scriptlet.nl?script=XXX&deploy=YYY

6. Update CONFIG.SUITELET_URL in Suitelet (Line 175) if needed

STEP 6: UPLOAD CLIENT SCRIPT
-----------------------------
Time: 10 minutes

1. Upload file: netsuite_assistant_client.js
   - Location: /SuiteScripts/
   - Note Internal ID

2. Create Client Script record:
   a. Go to: Customization > Scripting > Scripts > New
   b. Select file
   c. Create Script Record

   d. Fill in:
      - Name: AGTAX Assistant Client
      - ID: _agtax_assistant_cs
      - Page Init Function: pageInit

   e. Save (don't deploy yet - User Event will load it)

STEP 7: UPLOAD USER EVENT SCRIPT
---------------------------------
Time: 10 minutes

1. Upload file: netsuite_assistant_ue.js
   - Location: /SuiteScripts/
   - Note Internal ID

2. Create User Event Script record:
   a. Go to: Customization > Scripting > Scripts > New
   b. Select file
   c. Create Script Record

   d. Fill in:
      - Name: AGTAX Assistant Injector
      - ID: _agtax_assistant_ue
      - Before Load Function: beforeLoad

   e. Save

3. Create Deployment:
   a. Click "Deploy Script"

   b. Fill in:
      - Applies To: All Records (or specific records)
      - Event Type: View, Edit, Create
      - Status: Testing
      - Execute As Role: Administrator

   c. Save

STEP 8: TEST IN DEVELOPMENT
----------------------------
Time: 1 hour

1. Log into NetSuite

2. Navigate to any page (e.g., Dashboard)

3. Look for floating "?" button in bottom-right

4. Click button â†’ Chatbot should open

5. Test searches:
   - "TDS master"
   - "TDS payment"
   - "Create invoice"
   - "Vendor bill"

6. Verify:
   âœ“ Search returns ranked results
   âœ“ Clicking article loads content
   âœ“ Dynamic links work (buttons/links are clickable)
   âœ“ URLs open correct NetSuite pages
   âœ“ Back button returns to search results

7. Check browser console for errors

8. Check NetSuite Execution Log:
   - Customization > Scripting > Script Execution Log
   - Look for errors or warnings

9. Fix any issues before deploying to production

====================================================================
PART 3: DEPLOYING TO CLIENT ACCOUNTS
====================================================================

TIME PER CLIENT: ~30 minutes (after initial setup)

PREPARATION:
------------
1. Get client's NetSuite account ID
2. Get client's custom record type IDs (rectypes)
3. Confirm client has N/llm module enabled
4. Have admin access to client account

DEPLOYMENT PROCESS:
-------------------

STEP 1: Upload All Files (15 min)
----------------------------------
1. Upload to client's File Cabinet:
   - All 25 article files â†’ /SuiteScripts/Knowledge Base/articles/
   - Note new Internal IDs (will be different from dev!)

2. Create new articles_index.json for THIS client:
   - Update all file_id fields with new Internal IDs
   - Upload to /SuiteScripts/Knowledge Base/config/
   - Note its Internal ID

STEP 2: Configure Suitelet for Client (10 min)
-----------------------------------------------
1. Make a COPY of netsuite_assistant_COMPLETE_FINAL.js
   - Name it: netsuite_assistant_CLIENT_NAME.js

2. Update Line 21:
   INDEX_FILE_ID: 'XXXX', // Client's articles_index.json ID

3. Update Lines 30-120 with CLIENT's custom record types:

   Find client's rectype IDs:
   - Log into client account
   - Go to: Lists > TDS Master (or AG Tax records)
   - Check URL: ...?rectype=YYYY
   - YYYY is their rectype

   Update EACH custom record URL:

   TDS_MASTER: {
       createUrl: '/app/common/custom/custrecordentry.nl?rectype=YYYY',
       listUrl: '/app/common/custom/custrecordentrylist.nl?rectype=YYYY',
       ...
   },

4. Save client-specific Suitelet

5. Upload to client's File Cabinet: /SuiteScripts/

6. Create Script record and Deployment (same as Step 5 in Part 2)

STEP 3: Upload Client & User Event Scripts (5 min)
---------------------------------------------------
1. Upload client script (same file works for all clients)
2. Upload user event script (same file works for all clients)
3. Create Script records and Deployments

STEP 4: Test with Client (15 min)
----------------------------------
1. Log into client account
2. Open chatbot
3. Test searches specific to their setup
4. Verify dynamic URLs point to THEIR records
5. Confirm all links work correctly

STEP 5: Enable for Production
------------------------------
1. Change Suitelet deployment status: Testing â†’ Released
2. Change User Event deployment status: Testing â†’ Released
3. Set Log Level: Debug â†’ Error
4. Notify client users

====================================================================
PART 4: MAINTENANCE & UPDATES
====================================================================

ADDING NEW ARTICLES:
--------------------
1. Write new article with placeholders
2. Upload to File Cabinet in ALL client accounts
3. Note Internal IDs per account
4. Update articles_index.json for EACH account
5. Re-upload index files
6. No Suitelet changes needed!

UPDATING EXISTING ARTICLES:
---------------------------
1. Edit article file
2. Re-upload to File Cabinet (same file ID)
3. No other changes needed!
4. Repeat for all client accounts

ADDING NEW URL MAPPINGS:
-------------------------
1. Add to URL_MAPPINGS in Suitelet (Lines 30-120)
2. Update Suitelet for all clients
3. Re-deploy
4. Update articles to use new placeholders

MONITORING:
-----------
1. Check Script Execution Logs weekly:
   - Customization > Scripting > Script Execution Log
   - Look for errors

2. Monitor LLM Usage:
   - Check llm.getRemainingFreeUsage() in logs
   - Set up OCI credentials if approaching limit

3. User Feedback:
   - Add feedback mechanism to chatbot
   - Track common failed searches
   - Improve articles based on feedback

====================================================================
PART 5: TROUBLESHOOTING
====================================================================

ISSUE: Chatbot button not appearing
SOLUTION:
- Check User Event script deployment status
- Verify deployment applies to current record type
- Check browser console for JavaScript errors
- Verify client script is properly loaded

ISSUE: Search returns no results
SOLUTION:
- Check articles_index.json is uploaded and accessible
- Verify INDEX_FILE_ID in Suitelet is correct
- Check File Cabinet permissions
- Review Script Execution Log for errors

ISSUE: Dynamic links show "[RESOURCE not configured]"
SOLUTION:
- Resource not in URL_MAPPINGS
- Add resource to URL_MAPPINGS in Suitelet
- Verify rectype IDs are correct for this account

ISSUE: LLM quota exceeded
SOLUTION:
- Set up OCI credentials (Preferences > AI Preferences)
- Enable unlimited LLM usage
- Or implement caching to reduce calls

ISSUE: Articles load slowly
SOLUTION:
- Enable caching (CONFIG.ENABLE_CACHE = true)
- Increase CACHE_SIZE
- Check File Cabinet folder permissions
- Consider CDN for article delivery

ISSUE: Wrong URLs generated for client
SOLUTION:
- Verify rectype IDs in URL_MAPPINGS
- Check custom record internal IDs
- Test URLs manually in client account
- Update Suitelet configuration

====================================================================
PART 6: CONFIGURATION REFERENCE
====================================================================

SUITELET CONFIGURATION POINTS:
-------------------------------

Line 21: INDEX_FILE_ID
- Purpose: Points to articles_index.json
- Update: Every client deployment
- Find: File Cabinet Internal ID

Lines 30-120: URL_MAPPINGS
- Purpose: Maps placeholders to URLs
- Update: Every client (custom records only)
- Find: Custom record type IDs from URL

Lines 175-188: CONFIG Object
- Purpose: Global settings
- Update: Rarely (same for all clients usually)
- Settings:
  - LLM_MODEL: Usually keep default
  - MAX_TOKENS: Increase for longer answers
  - TEMPERATURE: Lower = more consistent
  - MAX_SEARCH_RESULTS: Number of results shown
  - ENABLE_CACHE: true for production

ARTICLES INDEX STRUCTURE:
--------------------------
{
  "articles": [
    {
      "id": 1,                    // Unique ID (1-25)
      "title": "Article Title",   // Display title
      "file_id": "3150",          // File Cabinet Internal ID
      "summary": "...",           // 1-2 sentence summary
      "keywords": ["...", "..."], // Search keywords
      "category": "TDS"           // Optional category
    }
  ]
}

PLACEHOLDER SYNTAX:
-------------------
[ACTION:RESOURCE] or [ACTION:RESOURCE:PARAM]

Actions:
- CREATE - Generate create record button
- LIST - Generate view all records link
- EDIT - Generate edit record link (needs ID param)
- VIEW - Same as LIST
- NAV - Navigate to custom page

Resources:
- Defined in URL_MAPPINGS
- Can be custom or standard records

Examples:
- [CREATE:TDS_MASTER]
- [LIST:INVOICES]
- [EDIT:VENDOR:12345]
- [NAV:REPORTS_TDS]

====================================================================
PART 7: OPTIMIZATION TIPS
====================================================================

PERFORMANCE:
------------
1. Enable caching for repeated queries
2. Limit article content size (<5KB per article)
3. Use token-efficient prompts
4. Implement CDN for File Cabinet files

COST REDUCTION:
---------------
1. Cache common search queries
2. Use hybrid keyword + LLM approach
3. Set up OCI credentials for production
4. Monitor llm.getRemainingFreeUsage()

USER EXPERIENCE:
----------------
1. Keep article summaries concise
2. Use clear, descriptive titles
3. Tag articles with relevant keywords
4. Test search with actual user queries
5. Add "Related Articles" section

SCALABILITY:
------------
1. Single codebase for all clients
2. Configuration-based customization
3. Modular article structure
4. Easy to add new articles
5. Version control for articles

====================================================================
SUPPORT & RESOURCES
====================================================================

Documentation:
- NetSuite N/llm module: https://docs.oracle.com/en/cloud/saas/netsuite/ns-online-help/article_9123730083.html
- SuiteScript 2.1 docs: https://docs.oracle.com/en/cloud/saas/netsuite/ns-online-help/chapter_4387799403.html

Logging:
- Always check: Customization > Scripting > Script Execution Log
- Enable Debug mode during testing
- Switch to Error mode in production

Questions?
- Review this deployment guide
- Check troubleshooting section
- Review code comments in Suitelet
- Test in sandbox first!

====================================================================
END OF DEPLOYMENT GUIDE
====================================================================

Congratulations! You now have a complete, production-ready AI
knowledge base assistant that works across multiple NetSuite clients
with NO hardcoded URLs.

Good luck with your deployment! ðŸš€
